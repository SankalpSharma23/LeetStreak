(function(){"use strict";(function(){console.log("LeetStreak: Content script loaded");let w=!1,S=null,E=!1,h=null;function D(){return window.location.pathname.startsWith("/problems/")&&window.location.pathname!=="/problems/"}function L(){try{const e=document.querySelector('[data-cy="question-title"]')||document.querySelector('div[class*="text-title"]'),t=e?e.textContent.trim():"Unknown Problem",o=window.location.pathname.split("/problems/")[1]?.split("/")[0]||"",r=document.querySelector("div[diff]")||document.querySelector('[class*="text-difficulty"]'),n=r?r.textContent.trim():"Medium",s=document.querySelector('[data-track-load="description_content"]')||document.querySelector('[class*="elfjS"]'),a=s?s.textContent.trim().substring(0,500):"",i=t.match(/^(\d+)\./),c=i?i[1]:"";return{title:t,slug:o,difficulty:n,description:a,number:c,url:window.location.href}}catch(e){return console.error("Error extracting problem data:",e),null}}function H(){try{const e=document.querySelector('[data-cy="question-title"]')?.parentElement;if(e&&e.querySelectorAll('svg[class*="check"], svg[class*="done"]').length>0)return console.log("Found checkmark in title area"),!0;const t=document.querySelectorAll("*");for(let n of t)if(n.textContent==="Solved"&&n.offsetParent!==null)return console.log('Found "Solved" badge'),!0;const o=document.querySelector('[data-cy="question-header"]')||document.querySelector('[class*="header"]');if(o&&o.querySelector('[class*="success"], [class*="accepted"], svg[class*="fill-green"]'))return console.log("Found success icon in header"),!0;const r=document.querySelector('[class*="top"], [data-cy="problem-statement"]');if(r){const n=r.querySelectorAll("svg");for(let s of n){const a=s.className.baseVal||s.className,i=s.getAttribute("fill")||s.style.fill;if((a.includes("check")||a.includes("done"))&&(i==="#22c55e"||i.includes("green")||a.includes("green")))return console.log("Found green checkmark SVG"),!0}}return!1}catch(e){return console.error("Error checking if problem solved:",e),!1}}function U(){try{const e=document.querySelectorAll(".view-lines");if(e.length>0)return Array.from(e[0].querySelectorAll(".view-line")).map(r=>r.textContent).join(`
`);const t=document.querySelector('textarea[class*="code"]');return t?t.value:""}catch(e){return console.error("Error extracting code:",e),""}}function G(){try{if(window.monaco&&window.monaco.editor){const o=window.monaco.editor.getModels();if(o.length>0){const r=o[0].getLanguageId();if(r&&r!=="plaintext")return y(r)}}const e=document.querySelector('button[title*="language"], button[aria-label*="language"]')||document.querySelector('[class*="lang-select"] button')||document.querySelector('button[id*="lang"]');if(e&&e.textContent){const o=e.textContent.trim();if(o&&o!=="")return y(o)}const t=document.querySelector("[data-mode-id]");if(t){const o=t.getAttribute("data-mode-id");if(o)return y(o)}try{const o=localStorage.getItem("global_lang");if(o){const r=JSON.parse(o);if(r.lang)return y(r.lang)}}catch{}return"python3"}catch(e){return console.error("Error detecting language:",e),"python3"}}function N(e,t,o,r=!1){const n=document.createElement("button");n.className=r?"leetstreak-floating-btn":"leetstreak-btn";const s=r?"linear-gradient(135deg, #ffa116 0%, #f89f1b 50%, #ffc01e 100%)":"linear-gradient(135deg, #ffa116 0%, #f89f1b 100%)",a=document.createElement("span");a.className="icon",a.style.cssText="display: inline-block; transition: transform 0.3s ease;",a.innerHTML=t;const i=document.createElement("span");if(i.className="text",i.textContent=e,n.appendChild(a),n.appendChild(i),r)n.style.cssText=`
        position: fixed;
        bottom: 24px;
        right: 24px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 14px 24px;
        background: ${s};
        color: #1a1a1a;
        border: none;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(255, 161, 22, 0.35);
        z-index: 10000;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        letter-spacing: 0.3px;
        text-transform: none;
      `;else{n.style.cssText=`
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 8px 16px;
        margin-left: 10px;
        background: ${s};
        color: #1a1a1a;
        border: none;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px rgba(255, 161, 22, 0.3);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        letter-spacing: 0.2px;
        position: relative;
        overflow: hidden;
        text-transform: none;
      `;const c=document.createElement("span");c.style.cssText=`
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s ease;
      `,n.appendChild(c),n.addEventListener("mouseenter",()=>{c.style.left="100%"})}return n.addEventListener("mouseenter",()=>{r?(n.style.transform="translateY(-2px)",n.style.boxShadow="0 6px 16px rgba(255, 161, 22, 0.45)"):(n.style.transform="translateY(-1px)",n.style.boxShadow="0 4px 12px rgba(255, 161, 22, 0.4)"),n.querySelector(".icon").style.transform="scale(1.1)"}),n.addEventListener("mouseleave",()=>{n.style.transform="translateY(0)",r?n.style.boxShadow="0 4px 12px rgba(255, 161, 22, 0.35)":n.style.boxShadow="0 2px 8px rgba(255, 161, 22, 0.3)",n.querySelector(".icon").style.transform="scale(1)"}),n.addEventListener("mousedown",()=>{n.style.transform="translateY(0) scale(0.98)"}),n.addEventListener("mouseup",()=>{r?n.style.transform="translateY(-2px)":n.style.transform="translateY(-1px)"}),n.addEventListener("click",c=>{const u=document.createElement("span"),l=n.getBoundingClientRect(),m=Math.max(l.width,l.height),b=c.clientX-l.left-m/2,x=c.clientY-l.top-m/2;if(u.style.cssText=`
        position: absolute;
        width: ${m}px;
        height: ${m}px;
        left: ${b}px;
        top: ${x}px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        transform: scale(0);
        animation: ripple 0.6s ease-out;
        pointer-events: none;
      `,!document.getElementById("leetstreak-ripple-animation")){const p=document.createElement("style");p.id="leetstreak-ripple-animation",p.textContent=`
          @keyframes ripple {
            to {
              transform: scale(4);
              opacity: 0;
            }
          }
        `,document.head.appendChild(p)}n.appendChild(u),setTimeout(()=>u.remove(),600),o(c)}),n}function v(){try{return typeof chrome<"u"&&typeof chrome.storage<"u"&&typeof chrome.storage.local<"u"}catch{return!1}}async function T(e){if(!v())throw d("‚ö†Ô∏è Extension reloaded. Please refresh this page (F5).","error"),new Error("Extension context invalidated");try{return await chrome.storage.local.get(e)}catch(t){const o=t.message||t.toString()||"";throw o.includes("Extension context invalidated")||o.includes("context invalidated")||o.includes("message port closed")||!v()?(d("‚ö†Ô∏è Extension reloaded. Please refresh this page (F5) to continue.","error"),new Error("Extension context invalidated")):t}}async function R(e){if(!v())throw d("‚ö†Ô∏è Extension reloaded. Please refresh this page (F5).","error"),new Error("Extension context invalidated");try{return await chrome.storage.local.set(e)}catch(t){const o=t.message||t.toString()||"";throw o.includes("Extension context invalidated")||o.includes("context invalidated")||o.includes("message port closed")||!v()?(d("‚ö†Ô∏è Extension reloaded. Please refresh this page (F5) to continue.","error"),new Error("Extension context invalidated")):t}}async function $(){if(S=L(),!S){d("‚ùå Could not extract problem data","error");return}H()&&(S.status="completed",console.log("Problem detected as solved on page"));try{const t=await new Promise((o,r)=>{try{if(typeof chrome>"u"||!chrome.runtime||!chrome.runtime.sendMessage){r(new Error("Extension not available"));return}chrome.runtime.sendMessage({type:"ADD_TO_QUEUE",problemData:S},n=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):o(n)})}catch(n){r(n)}});if(t.success){const o=t.status==="completed"?"‚úÖ Added to queue! (Already Submitted ‚úì)":"‚úÖ Added to queue!";d(o,"success")}else t.alreadyExists?d("üìã Already in queue!","info"):d("‚ùå "+(t.error||"Failed to add to queue"),"error")}catch(t){console.error("Error adding to queue:",t);const o=t.message||t.toString()||"";o.includes("Extension context invalidated")||o.includes("message port closed")||o.includes("Extension not available")?d("‚ö†Ô∏è Extension reloaded. Please refresh this page (F5).","error"):d("‚ùå Failed to add to queue: "+o.substring(0,50),"error")}}async function O(){S=L();const e=U();let t=G();if(!e){d("‚ùå No code found. Write some code first!","error");return}if(!t||t==="python3"){const o=ne(e);o&&(t=o,console.log("LeetStreak: Detected language from code analysis:",t))}d("üì∏ Generating screenshot...","info"),Y(S,e,t)}function Y(e,t,o){const r=document.getElementById("leetstreak-screenshot-modal");r&&r.remove();const n=document.createElement("div");n.id="leetstreak-screenshot-modal",n.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(4px);
    `;const s=document.createElement("div");s.style.cssText=`
      background: white;
      border-radius: 16px;
      max-width: 900px;
      max-height: 90vh;
      overflow: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      scrollbar-width: none;
      -ms-overflow-style: none;
    `,s.style.webkitScrollbar="none";const a=V(e,t,o);s.appendChild(a),n.appendChild(s),document.body.appendChild(n),n.addEventListener("click",u=>{u.target===n&&n.remove()});const i=document.getElementById("leetstreak-close-modal"),c=document.getElementById("leetstreak-download-screenshot");i&&i.addEventListener("click",()=>{n.remove()}),c?c.addEventListener("click",async u=>{u.preventDefault(),u.stopPropagation(),console.log("Download button clicked"),await J(e.title)}):console.error("Download button not found in modal"),W()}function W(){if(document.getElementById("leetstreak-scrollbar-css"))return;const e=document.createElement("style");e.id="leetstreak-scrollbar-css",e.textContent=`
      #leetstreak-screenshot-modal ::-webkit-scrollbar {
        display: none;
      }
      #leetstreak-screenshot-modal {
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      #leetstreak-screenshot-modal * {
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      #leetstreak-screenshot-modal *::-webkit-scrollbar {
        display: none;
      }
    `,document.head.appendChild(e)}function V(e,t,o){const r={easy:"#3fb950",medium:"#d29922",hard:"#da3633"},n=r[e.difficulty.toLowerCase()]||r.medium,s="linear-gradient(135deg, #0d1117 0%, #161b22 100%)",a=document.createElement("div");a.style.cssText="padding: 32px; background: #0d1117; min-height: 100vh;";const i=document.createElement("div");i.style.cssText="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;";const c=document.createElement("h2");c.textContent="‚ú® Code Screenshot",c.style.cssText="margin: 0; font-size: 32px; color: #c9d1d9; font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif; font-weight: 800; letter-spacing: -0.5px;";const u=document.createElement("button");u.id="leetstreak-close-modal",u.textContent="‚úï",u.style.cssText="background: #21262d; border: 1px solid #30363d; font-size: 24px; cursor: pointer; color: #8b949e; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; border-radius: 12px; transition: all 0.2s ease; font-weight: 300;",u.onmouseover=function(){this.style.background="#30363d",this.style.color="#c9d1d9",this.style.transform="scale(1.05)"},u.onmouseout=function(){this.style.background="#21262d",this.style.color="#8b949e",this.style.transform="scale(1)"},i.appendChild(c),i.appendChild(u);const l=document.createElement("div");l.id="leetstreak-screenshot-content",l.style.cssText=`background: ${s}; border-radius: 24px; padding: 48px; color: #c9d1d9; font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); border: 1px solid #30363d;`;const m=document.createElement("div");m.style.cssText="margin-bottom: 36px;";const b=document.createElement("div");b.style.cssText="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;";const x=document.createElement("span");if(x.textContent=e.difficulty.toUpperCase(),x.style.cssText=`background: ${n}20; padding: 6px 16px; border-radius: 12px; font-size: 13px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.8px; color: ${n}; box-shadow: 0 4px 12px ${n}20; font-family: 'Inter', sans-serif; border: 1px solid ${n}40;`,b.appendChild(x),e.number){const I=document.createElement("span");I.textContent=`#${e.number}`,I.style.cssText="opacity: 0.9; font-size: 15px; font-weight: 700; font-family: 'Inter', sans-serif;",b.appendChild(I)}const p=document.createElement("h1");p.textContent=e.title,p.style.cssText="margin: 0; font-size: 36px; font-weight: 900; line-height: 1.2; color: #e6edf3; font-family: 'Inter', sans-serif; letter-spacing: -0.8px;",m.appendChild(b),m.appendChild(p);const f=document.createElement("div");f.style.cssText="background: #0d1117; border-radius: 18px; padding: 28px; border: 1px solid #30363d;";const k=document.createElement("div");k.style.cssText="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 14px; border-bottom: 1px solid #30363d;";const A=document.createElement("span");A.textContent=oe(o),A.style.cssText="font-size: 14px; opacity: 1; font-weight: 800; color: #58a6ff; font-family: 'Inter', sans-serif; letter-spacing: 0.5px;";const B=document.createElement("span");B.textContent=new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),B.style.cssText="font-size: 13px; opacity: 0.85; font-weight: 600; font-family: 'Inter', sans-serif; color: #8b949e;",k.appendChild(A),k.appendChild(B);const P=document.createElement("pre");P.textContent=t,P.style.cssText="margin: 0; font-family: 'JetBrains Mono', 'SF Mono', 'Monaco', 'Consolas', monospace; font-size: 15px; line-height: 1.8; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; color: #e6edf3; font-weight: 500; max-height: 400px; overflow-y: auto;",f.appendChild(k),f.appendChild(P);const C=document.createElement("div");C.style.cssText="margin-top: 36px; display: flex; justify-content: space-between; align-items: center; opacity: 0.95; font-size: 14px; font-weight: 700; font-family: 'Inter', sans-serif;";const F=document.createElement("span");F.textContent="üî• LeetStreak",F.style.cssText="color: #58a6ff; font-size: 16px;";const _=document.createElement("span");_.textContent="leetcode.com",_.style.cssText="font-weight: 600; color: #8b949e;",C.appendChild(F),C.appendChild(_),l.appendChild(m),l.appendChild(f),l.appendChild(C);const j=document.createElement("div");j.style.cssText="display: flex; gap: 12px; margin-top: 28px; padding-top: 28px; border-top: 1px solid #30363d; justify-content: flex-end; flex-wrap: wrap;";const g=document.createElement("button");return g.id="leetstreak-download-screenshot",g.textContent="‚¨áÔ∏è Download PNG",g.style.cssText="padding: 12px 28px; background: #000000; color: #ff8c00; border: 2px solid #ff8c00; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 6px 20px rgba(255, 140, 0, 0.25); font-family: 'Inter', 'SF Pro Display', sans-serif; letter-spacing: 0.3px; white-space: nowrap;",g.onmouseover=function(){this.style.transform="translateY(-2px)",this.style.boxShadow="0 10px 30px rgba(255, 140, 0, 0.35)",this.style.background="#1a1a1a"},g.onmouseout=function(){this.style.transform="translateY(0)",this.style.boxShadow="0 6px 20px rgba(255, 140, 0, 0.25)",this.style.background="#000000"},g.onmousedown=function(){this.style.transform="translateY(0px)"},g.onmouseup=function(){this.style.transform="translateY(-2px)"},j.appendChild(g),a.appendChild(i),a.appendChild(l),a.appendChild(j),a}async function J(e){try{console.log("Starting download process...");const t=document.getElementById("leetstreak-screenshot-content");if(!t){console.error("Screenshot element not found"),d("‚ùå Screenshot element not found","error");return}console.log("Screenshot element found, capturing visual content..."),d("üì∏ Capturing screenshot...","info");const o=document.createElement("div");o.style.position="fixed",o.style.top="-9999px",o.style.left="-9999px",o.style.width=t.offsetWidth+96+"px",o.style.height=t.offsetHeight+96+"px",o.style.padding="48px",o.style.boxSizing="border-box",o.style.background="linear-gradient(135deg, #0d1117 0%, #161b22 100%)",o.style.borderRadius="24px",o.style.border="1px solid #30363d",o.style.overflow="hidden";const r=t.cloneNode(!0);o.appendChild(r),document.body.appendChild(o);const n=o.offsetWidth,s=o.offsetHeight;console.log("Wrapper dimensions:",n,"x",s);const a=document.createElement("canvas"),i=window.devicePixelRatio||1;a.width=n*i,a.height=s*i;const c=a.getContext("2d",{alpha:!1});if(!c)throw new Error("Could not get canvas context");if(c.scale(i,i),typeof html2canvas<"u"){console.log("Using html2canvas to render");try{const u=await html2canvas(o,{backgroundColor:"#0d1117",scale:2,useCORS:!0,allowTaint:!0,logging:!1,width:n,height:s});document.body.removeChild(o),console.log("Canvas rendered successfully"),u.toBlob(l=>{l?(console.log("Blob created, size:",l.size),q(l,e)):(console.error("Blob is null"),d("‚ùå Failed to create image blob","error"))},"image/png",1)}catch(u){console.error("html2canvas error:",u),document.body.removeChild(o),d("‚ùå Failed to render screenshot","error")}}else{console.log("html2canvas not available, loading from CDN");const u=await Q();if(document.body.removeChild(o),u&&typeof html2canvas<"u")try{const l=await html2canvas(o,{backgroundColor:"#0d1117",scale:2,useCORS:!0,allowTaint:!0,logging:!1});console.log("Canvas rendered from CDN library"),l.toBlob(m=>{m?(console.log("Blob created, size:",m.size),q(m,e)):d("‚ùå Failed to create image","error")},"image/png",1)}catch(l){console.error("html2canvas error:",l),d("‚ùå Screenshot capture failed","error")}else{console.log("Fallback: using simple canvas rendering");try{c.fillStyle="#0d1117",c.fillRect(0,0,n,s);const l=c.createLinearGradient(0,0,n,s);l.addColorStop(0,"#0d1117"),l.addColorStop(1,"#161b22");const m=24;c.beginPath(),c.moveTo(m,0),c.lineTo(n-m,0),c.arcTo(n,0,n,m,m),c.lineTo(n,s-m),c.arcTo(n,s,n-m,s,m),c.lineTo(m,s),c.arcTo(0,s,0,s-m,m),c.lineTo(0,m),c.arcTo(0,0,m,0,m),c.closePath(),c.fillStyle=l,c.fill(),c.strokeStyle="#30363d",c.lineWidth=1,c.stroke(),c.fillStyle="#c9d1d9",c.font='14px "JetBrains Mono", monospace';const x=(t.textContent||"").split(`
`);let p=80;for(const f of x){if(p>s-30)break;c.fillText(f.substring(0,110),80,p),p+=20}console.log("Canvas rendered with fallback method"),a.toBlob(f=>{f?(console.log("Fallback blob created, size:",f.size),q(f,e)):(console.error("Fallback blob creation failed"),d("‚ùå Failed to create image","error"))},"image/png",1)}catch(l){console.error("Fallback rendering error:",l),d("‚ùå "+l.message,"error")}}}}catch(t){console.error("Download error:",t),d("‚ùå "+(t.message||"Download failed"),"error")}}function Q(){return new Promise(e=>{if(typeof html2canvas<"u"){console.log("html2canvas already loaded"),e(!0);return}const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js",t.async=!0,t.onload=()=>{console.log("html2canvas loaded from CDN"),e(!0)},t.onerror=()=>{console.error("Failed to load html2canvas from CDN"),e(!1)},document.head.appendChild(t)})}function q(e,t){try{console.log("Blob created, size:",e.size);const o=URL.createObjectURL(e),r=document.createElement("a"),n=(t||"code_screenshot").replace(/[^a-z0-9_-]/gi,"_").substring(0,50);r.download=`${n}_leetstreak.png`,r.href=o,r.style.display="none",document.body.appendChild(r),console.log("Triggering download: "+r.download),r.click(),setTimeout(()=>{try{document.body.contains(r)&&document.body.removeChild(r),URL.revokeObjectURL(o)}catch(s){console.error("Cleanup error:",s)}},100),d("‚úÖ Screenshot downloaded!","success")}catch(o){console.error("Download blob error:",o),d("‚ùå "+o.message,"error")}}function d(e,t="info"){const o=document.getElementById("leetstreak-notification");o&&o.remove();const r={success:"#10b981",error:"#ef4444",info:"#667eea"},n=document.createElement("div");n.id="leetstreak-notification",n.textContent=e,n.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${r[t]};
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      z-index: 10001;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: slideInRight 0.3s ease;
    `,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOutRight 0.3s ease",setTimeout(()=>n.remove(),300)},3e3)}function M(){try{if(w)return;if(console.log("LeetStreak: Attempting to inject buttons..."),document.getElementById("leetstreak-buttons")){console.log("LeetStreak: Buttons already exist"),w=!0;return}let e=null;try{const n=document.querySelector('[data-e2e-locator*="console"]');n&&n.parentElement&&(e=n.parentElement.parentElement,console.log("LeetStreak: Found via testid"))}catch{}if(!e)try{const s=Array.from(document.querySelectorAll("button")).find(a=>{try{return a&&a.textContent&&(a.textContent.includes("Submit")||a.textContent.includes("Run")||a.textContent.includes("Test"))}catch{return!1}});s&&s.parentElement&&(e=s.parentElement,console.log("LeetStreak: Found via submit button"))}catch{}if(!e)try{const n=document.querySelectorAll('div[class*="flex"]');for(const s of n)try{if(s&&s.querySelectorAll&&s.querySelectorAll("button").length>=2&&s.offsetHeight>30){e=s,console.log("LeetStreak: Found via flex container");break}}catch{continue}}catch{}if(!e)try{const n=document.querySelectorAll('[class*="header"], [class*="toolbar"]');n.length>0&&n[0]&&(e=n[0],console.log("LeetStreak: Found via header"))}catch{}if(!e){console.log("LeetStreak: Could not find injection point. Will retry...");return}console.log("LeetStreak: Found injection point:",e);const t=document.createElement("div");t.id="leetstreak-buttons",t.style.cssText=`
        display: inline-flex;
        gap: 8px;
        align-items: center;
        margin-left: 12px;
        z-index: 100;
      `;const o=N("Add to Queue",'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/><line x1="12" y1="7" x2="12" y2="13"/><line x1="15" y1="10" x2="9" y2="10"/></svg>',$),r=N("Code Screenshot",'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>',O);t.appendChild(o),t.appendChild(r),e.appendChild(t),w=!0,console.log("LeetStreak: Buttons injected successfully!")}catch(e){console.error("LeetStreak: Error in injectButtons:",e)}}async function K(){const e=[X,Z,ee];for(let t=0;t<3;t++){for(const o of e)try{const r=await o();if(r&&r.trim().length>0)return{success:!0,code:r.trim(),method:o.name}}catch{}t<2&&await new Promise(o=>setTimeout(o,200))}return{success:!1,code:null}}function X(){if(typeof window.monaco>"u"||!window.monaco.editor)throw new Error("Monaco not available");const e=window.monaco.editor.getModels();if(!e||e.length===0)throw new Error("No models");const o=(e.find(r=>!r.uri.toString().includes("test"))||e[0]).getValue();if(!o)throw new Error("Empty");return o}function Z(){const e=document.querySelector(".monaco-editor textarea")||document.querySelector("textarea");if(e&&e.value)return e.value;throw new Error("No textarea")}function ee(){const e=document.querySelectorAll(".view-lines .view-line");if(e.length>0)return Array.from(e).map(t=>t.textContent).join(`
`);throw new Error("No visible lines")}function te(){try{if(window.monaco&&window.monaco.editor){const t=window.monaco.editor.getModels();if(t.length>0){const o=t[0].getLanguageId();if(o)return y(o)}}}catch{}const e=document.querySelector("[data-mode-id]")||document.querySelector(".ant-select-selection-item");if(e){const t=e.getAttribute("data-mode-id")||e.textContent;if(t)return y(t)}try{const t=localStorage.getItem("global_lang");if(t){const o=JSON.parse(t);if(o.lang)return y(o.lang)}}catch{}return"python3"}function y(e){if(!e||typeof e!="string")return"python3";const t=e.toLowerCase().trim();return{python:"python3",py:"python3",python3:"python3",javascript:"javascript",js:"javascript",ecmascript:"javascript",typescript:"typescript",ts:"typescript",java:"java","c++":"cpp",cpp:"cpp","c++17":"cpp","c++20":"cpp",c:"c",csharp:"csharp","c#":"csharp",cs:"csharp",go:"go",rust:"rust",php:"php",swift:"swift",kotlin:"kotlin",kt:"kotlin",ruby:"ruby",rb:"ruby",r:"r",scala:"scala",bash:"bash",shell:"bash",sql:"sql"}[t]||t}function oe(e){return{python3:"Python",javascript:"JavaScript",typescript:"TypeScript",java:"Java",cpp:"C++",c:"C",csharp:"C#",go:"Go",rust:"Rust",swift:"Swift",kotlin:"Kotlin",php:"PHP",ruby:"Ruby",r:"R",scala:"Scala",bash:"Bash",sql:"SQL"}[e.toLowerCase()]||e.charAt(0).toUpperCase()+e.slice(1)}function ne(e){if(!e||typeof e!="string")return null;const t={java:[/\bpublic\s+class\s+\w+/,/\bpublic\s+static\s+void\s+main/,/\bimport\s+java\./,/\bnew\s+\w+\s*\(/],cpp:[/#include\s*[<"]/,/\busing\s+namespace\s+std/,/std::/,/\bvector<|map<|unordered_map</],c:[/#include\s*["<](stdio|stdlib|string)[.>h"]/,/printf\s*\(/,/scanf\s*\(/,/\bmalloc\s*\(/],python:[/\bdef\s+\w+\s*\(/,/\bclass\s+\w+\s*:/,/\bif\s+__name__\s*==\s*['"]__main__['"]/,/\bimport\s+\w+|from\s+\w+\s+import/],javascript:[/\bfunction\s+\w+\s*\(|const\s+\w+\s*=\s*\(|let\s+\w+\s*=|var\s+\w+\s*=/,/\bconst\s+.*=.*=>|function\s*\(/,/console\.(log|error|warn)/,/\brequire\s*\(|import\s+.*from/],typescript:[/:\s*(string|number|boolean|any|void|interface|type|enum)/,/\binterface\s+\w+|type\s+\w+\s*=/,/public\s+\w+\s*:/,/\b<\w+>/],go:[/\bpackage\s+main/,/\bfunc\s+\w+\s*\(/,/\bimport\s*\(/,/\berr\s+!=\s+nil/],rust:[/\bfn\s+\w+\s*\(/,/\bmut\s+\w+/,/\b&str|String::|Vec::/,/\blet\s+mut\s+\w+/],csharp:[/\busing\s+System/,/\bpublic\s+(class|interface|struct|enum)/,/\bnamespace\s+\w+/,/\bvar\s+\w+\s*=/],php:[/<\?php|<\?/,/\$\w+\s*=/,/\bfunction\s+\w+\s*\(/,/echo\s+|print\s+/]};let o={lang:null,score:0};for(const[r,n]of Object.entries(t)){let s=0;for(const a of n){const i=e.match(a);i&&(s+=i.length)}s>o.score&&(o={lang:r,score:s})}return o.score>0?o.lang:null}function re(e){return{python3:"py",javascript:"js",typescript:"ts",java:"java",cpp:"cpp",c:"c",csharp:"cs",go:"go",rust:"rs",swift:"swift",kotlin:"kt",php:"php",ruby:"rb",r:"r",scala:"scala",bash:"sh",sql:"sql"}[e]||"txt"}async function z(){try{const e=await T(["github_sync_enabled","github_username","github_repo","github_token_encrypted"]);console.log("üìä GitHub sync storage check:",{enabled:e.github_sync_enabled,hasEncryptedToken:!!e.github_token_encrypted,username:e.github_username,repo:e.github_repo}),e.github_sync_enabled&&e.github_token_encrypted?(E=!0,console.log("‚úÖ LeetStreak: GitHub sync is ENABLED"),se()):(console.log("‚ùå LeetStreak: GitHub sync is DISABLED"),e.github_sync_enabled||console.log("  - Reason: github_sync_enabled flag not set"),e.github_token_encrypted||console.log("  - Reason: github_token_encrypted not found in storage"))}catch(e){console.error("LeetStreak: Failed to initialize GitHub sync:",e)}}function se(){console.log("LeetStreak: Setting up submit button listener..."),document.addEventListener("click",async e=>{try{const o=e.target.closest("button");if(!o)return;const r=o.textContent||"";(r.includes("Submit")&&!r.includes("Submission")&&o.getAttribute("data-e2e-locator")==="console-submit-button"||r.trim()==="Submit"&&!o.disabled)&&E&&(console.log("üöÄ LeetStreak: Submit button clicked! Capturing code..."),await ae())}catch(t){if(t.message&&t.message.includes("Extension context invalidated"))return;console.error("LeetStreak: Error in submit button listener:",t)}},!0),console.log("LeetStreak: Submit button listener active")}async function ae(){try{console.log("LeetStreak: Starting code capture...");const e=await K();if(console.log("LeetStreak: Code capture result:",e.success?"SUCCESS":"FAILED"),!e.success){console.warn("LeetStreak: Code capture failed"),d("‚ö†Ô∏è Could not capture code","error");return}console.log("LeetStreak: Code captured:",e.code.length,"characters");const t=te(),o=re(t);console.log("LeetStreak: Detected language:",t);const r=ce();if(!r){console.warn("LeetStreak: Failed to extract problem metadata"),d("‚ö†Ô∏è Could not extract problem data","error");return}console.log("LeetStreak: Problem data:",r.title);const n={code:e.code,language:t,extension:o,problemTitle:r.title,problemSlug:r.slug,difficulty:r.difficulty,topics:r.topics||["Unsorted"],questionNumber:r.number,problemUrl:window.location.href,timestamp:Date.now(),captureMethod:e.method},s=`pending_${r.slug}_${Date.now()}`;await R({[s]:n}),console.log("‚úÖ LeetStreak: Code captured and stored as pending:",s),d("üìù Code captured! Waiting for result...","info"),le(s,n)}catch(e){console.error("‚ùå LeetStreak: Submission capture failed:",e),d("‚ùå Capture failed: "+e.message,"error")}}function ce(){try{const e=L();if(!e)return null;const t=ie();return{...e,topics:t.length>0?t:["Unsorted"]}}catch(e){return console.error("Error extracting problem metadata:",e),null}}function ie(){const e=[];try{document.querySelectorAll('[class*="topic-tag"]').forEach(o=>{const r=o.textContent.trim();r&&e.push(r)}),e.length===0&&document.querySelectorAll('a[href*="/tag/"]').forEach(r=>{const n=r.textContent.trim();n&&e.push(n)}),e.length===0&&document.querySelectorAll("script").forEach(r=>{if(r.textContent.includes('"topicTags"'))try{const n=r.textContent.match(/"topicTags":\s*\[([^\]]+)\]/);if(n){const a=n[1].matchAll(/"name":"([^"]+)"/g);for(const i of a)e.push(i[1])}}catch{}})}catch(t){console.warn("Error extracting topics:",t)}return[...new Set(e)]}function le(e,t){console.log("LeetStreak: Starting submission watcher..."),h&&h.disconnect();const o=300*1e3,r=Date.now();h=new MutationObserver(async s=>{if(Date.now()-r>o){console.log("‚è±Ô∏è LeetStreak: Submission watch timeout"),h.disconnect(),await fe(e);return}if(ue()){console.log("‚úÖ LeetStreak: Submission ACCEPTED! Extracting stats..."),h.disconnect(),d("‚úÖ Accepted! Extracting stats...","success"),await new Promise(c=>setTimeout(c,1500));const a=de();console.log("üìä Performance stats:",a);const i={...t,...a};d("‚úÖ Syncing to GitHub...","success"),await pe(e,i)}me()&&(console.log("‚ùå LeetStreak: Submission failed, discarding"),h.disconnect(),await ge(e))}),[document.body,document.querySelector('[data-e2e-locator="submission-result"]'),document.querySelector("#qd-content"),document.querySelector('[class*="result"]')].filter(Boolean).forEach(s=>{h.observe(s,{childList:!0,subtree:!0,characterData:!0,attributes:!0})}),console.log(`LeetStreak: Watching for submission result (timeout: ${o/1e3}s)`)}function de(){const e={runtime:null,runtimePercentile:null,memory:null,memoryPercentile:null,acceptanceRate:null};try{const t=document.querySelector('[data-e2e-locator="submission-result"]')||document.querySelector('[class*="result"]');if(t){const s=t.textContent,a=s.match(/(?:Runtime[:\s]*)?(\d+)\s*ms/i);a&&(e.runtime=`${a[1]} ms`);const i=s.match(/(?:Beats|faster than)\s*([\d.]+)\s*%/i);i&&(e.runtimePercentile=parseFloat(i[1]).toFixed(1));const c=s.match(/(?:Memory[:\s]*)?([\d.]+)\s*MB/i);c&&(e.memory=`${c[1]} MB`);const l=[...s.matchAll(/(?:Beats|less than)\s*([\d.]+)\s*%/gi)].map(m=>parseFloat(m[1]));l.length>=2?(e.runtimePercentile=l[0].toFixed(1),e.memoryPercentile=l[1].toFixed(1)):l.length===1&&!e.runtimePercentile&&(e.runtimePercentile=l[0].toFixed(1))}document.querySelectorAll('[class*="flex"][class*="items-center"]').forEach(s=>{const a=s.textContent;if(a.includes("ms")&&!e.runtime){const i=a.match(/(\d+)\s*ms/);i&&(e.runtime=`${i[1]} ms`)}if(a.includes("MB")&&!e.memory){const i=a.match(/([\d.]+)\s*MB/);i&&(e.memory=`${i[1]} MB`)}}),document.querySelectorAll('[class*="percent"], [class*="beats"]').forEach(s=>{const i=s.textContent.match(/([\d.]+)\s*%/);if(i){const c=parseFloat(i[1]).toFixed(1),u=s.closest('[class*="runtime"], [class*="memory"]');u&&(u.className.includes("runtime")&&!e.runtimePercentile?e.runtimePercentile=c:u.className.includes("memory")&&!e.memoryPercentile&&(e.memoryPercentile=c))}}),document.querySelectorAll("script").forEach(s=>{const a=s.textContent;if(a.includes("statusRuntime")||a.includes("runtimePercentile"))try{const i=a.match(/"statusRuntime"\s*:\s*"?(\d+)\s*ms"?/);i&&!e.runtime&&(e.runtime=`${i[1]} ms`);const c=a.match(/"runtimePercentile"\s*:\s*([\d.]+)/);c&&!e.runtimePercentile&&(e.runtimePercentile=parseFloat(c[1]).toFixed(1));const u=a.match(/"statusMemory"\s*:\s*"?([\d.]+)\s*MB"?/);u&&!e.memory&&(e.memory=`${u[1]} MB`);const l=a.match(/"memoryPercentile"\s*:\s*([\d.]+)/);l&&!e.memoryPercentile&&(e.memoryPercentile=parseFloat(l[1]).toFixed(1))}catch{}});try{const s=document.querySelector('[class*="acceptance"], [class*="Acceptance"]');if(s){const a=s.textContent.match(/([\d.]+)\s*%/);a&&(e.acceptanceRate=parseFloat(a[1]).toFixed(1))}if(!e.acceptanceRate){const i=document.body.textContent.match(/Acceptance Rate\s*:?\s*([\d.]+)\s*%/i);i&&(e.acceptanceRate=parseFloat(i[1]).toFixed(1))}}catch{}return console.log("üìä Extracted performance stats:",e),e}catch(t){return console.error("Error extracting performance stats:",t),e}}function ue(){return[()=>{const t=document.querySelector('[data-e2e-locator="submission-result"]');return t&&t.textContent.includes("Accepted")?(console.log("Found Accepted in submission-result"),!0):!1},()=>{const t=document.querySelector('.text-green-500, .text-green-600, [class*="text-green"]');return t&&t.textContent.includes("Accepted")?(console.log("Found Accepted in green text"),!0):!1},()=>{const t=document.querySelectorAll('[class*="success"]');for(const o of t)if(o.textContent.includes("Accepted"))return console.log("Found Accepted in success element"),!0;return!1},()=>{const t=document.querySelectorAll("div");for(const o of t)if(o.textContent.trim()==="Accepted"&&o.className.includes("text"))return console.log("Found Accepted div with text class"),!0;return!1}].some(t=>{try{return t()}catch{return!1}})}function me(){return["Wrong Answer","Time Limit Exceeded","Runtime Error","Compile Error"].some(t=>{const o=document.querySelector('[data-e2e-locator="submission-result"]');return o&&o.textContent.includes(t)})}async function pe(e,t){try{if(console.log("üêô LeetStreak: GitHub Auto-Sync triggered"),console.log("üì§ Sending GitHub sync message to background with:",{submissionId:e,problemTitle:t.problemTitle,language:t.language,codeLength:t.code?.length||0}),!e)throw new Error("submissionId is required");if(!t)throw new Error("submission object is required");console.log("‚úÖ Submission data validated"),console.log("üèì Pinging service worker to keep it awake...");try{await new Promise((s,a)=>{const i=setTimeout(()=>{a(new Error("Service worker ping timeout"))},2e3);console.log("Calling chrome.runtime.sendMessage with PING..."),chrome.runtime.sendMessage({type:"PING"},c=>{console.log("PING response received:",c),clearTimeout(i),chrome.runtime.lastError?(console.error("PING error:",chrome.runtime.lastError),a(chrome.runtime.lastError)):s(c)})}),console.log("‚úÖ Service worker is awake")}catch(s){console.warn("‚ö†Ô∏è Service worker ping failed, proceeding anyway:",s.message)}let o=0;const r=3,n=()=>{console.log("üöÄ LeetStreak: About to send GITHUB_SYNC_SUBMISSION message..."),console.log("üìã submissionId:",e),console.log("üìã submission object:",t),chrome.runtime.sendMessage({type:"GITHUB_SYNC_SUBMISSION",submissionId:e,submission:t},s=>{if(console.log("üì¨ LeetStreak: Message callback received, response:",s),chrome.runtime.lastError){console.error("‚ùå LeetStreak: Message delivery error:",chrome.runtime.lastError.message),o<r?(console.log(`‚è≥ Retry ${o+1}/${r}...`),o++,setTimeout(n,1e3)):d("‚ùå Sync failed: Extension error","error");return}s&&s.success?(console.log("‚úÖ LeetStreak: GitHub auto-sync response received - SUCCESS"),d("‚úÖ Synced to GitHub!","success")):(console.error("‚ùå LeetStreak: GitHub auto-sync response - FAILURE:",s?.error),d("‚ö†Ô∏è Auto-sync failed. Stored as pending.","info"))})};console.log("About to call sendMessage function"),n(),console.log("sendMessage function called")}catch(o){console.error("‚ùå LeetStreak: Critical error in triggerGitHubSync:",o),console.error("Error stack:",o.stack),d("‚ùå Sync error: "+o.message,"error")}}async function fe(e){try{const o=(await T([e]))[e];if(o){const n=(await T("failed_syncs")).failed_syncs||[];n.push({submission:o,error:"Timeout: No result detected within 5 minutes",timestamp:Date.now(),retryCount:0}),await R({failed_syncs:n})}await chrome.storage.local.remove(e),console.log("LeetStreak: Marked submission as expired")}catch(t){console.error("LeetStreak: Failed to mark submission as expired:",t)}}async function ge(e){try{await chrome.storage.local.remove(e),console.log("LeetStreak: Discarded pending submission")}catch(t){console.error("LeetStreak: Failed to discard submission:",t)}}function he(){if(!D()){console.log("LeetStreak: Not on a problem page");return}console.log("LeetStreak: Initializing on problem page..."),z(),setTimeout(()=>{w||M()},1500),setTimeout(()=>{w||(console.log("LeetStreak: Retrying button injection..."),M())},4e3);let e=location.href;const t=new MutationObserver(()=>{try{const o=location.href;o!==e&&(e=o,w=!1,E=!1,D()&&(console.log("LeetStreak: URL changed, re-injecting..."),z(),setTimeout(()=>M(),2e3)))}catch(o){o.message&&!o.message.includes("Extension context")&&console.error("LeetStreak: URL observer error:",o)}});try{t.observe(document,{subtree:!0,childList:!0})}catch(o){console.error("LeetStreak: Failed to observe URL changes:",o)}}function ye(){if(typeof html2canvas<"u"){console.log("LeetStreak: html2canvas already loaded");return}const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js",e.async=!0,e.onload=()=>{console.log("LeetStreak: html2canvas loaded successfully")},e.onerror=()=>{console.warn("LeetStreak: Failed to load html2canvas from CDN");const t=document.createElement("script");t.src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js",t.async=!0,t.onload=()=>console.log("LeetStreak: html2canvas loaded from unpkg"),t.onerror=()=>console.error("LeetStreak: All html2canvas CDN sources failed"),document.head.appendChild(t)},document.head.appendChild(e)}he(),ye()})()})();
